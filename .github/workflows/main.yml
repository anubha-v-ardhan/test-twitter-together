name: Issue Forms Body Parser

on: issues

jobs:
  issue_parser:
    runs-on: ubuntu-latest
    name: Grab body of latest issue
    steps:
    - name: checkout
      uses: actions/checkout@v2
    - name: Run Issue form parser
      uses: stefanbuck/github-issue-parser@v2
      id: issue-parser
      with:
        template-path: .github/ISSUE_TEMPLATE/new-tweet-request.yaml
    - run: |
        echo '${{ steps.issue-parser.outputs.jsonString }}' > bug-details.json
        string=$(jq '.tweet' bug-details.json)
        echo ${string:1:-1} >> ./tweets/${{ steps.issue-parser.outputs.issueNumber}}.tweet
        cat ./tweets/${{ steps.issue-parser.outputs.issueNumber}}.tweet
    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: Add new tweet file via automation
        title: 'add: new tweet file via automation'
        body: |
          This PR is auto-generated.
          Fixes: #${{ steps.issue-parser.outputs.issueNumber}}
        branch: add/${{ steps.issue-parser.outputs.issueNumber}}
        base: main
        signoff: true
        delete-branch: true
        
